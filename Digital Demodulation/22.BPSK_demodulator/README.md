# BPSK解调器 - 1MHz载波Costas环实现

## 项目简介

本项目实现了一个基于FPGA的BPSK（二进制相位键控）解调器，采用Costas环路进行载波恢复。该解调器能够处理1MHz载波频率的BPSK调制信号，实现数字锁相环功能。

## 项目特性

- **载波频率**: 1MHz
- **解调方式**: Costas环载波恢复
- **数字锁相环**: 完全数字化实现
- **FIR滤波器**: 31阶低通滤波器，截止频率0.001π
- **NCO**: 32位相位累加器，8位输出
- **环路滤波器**: PI控制器，支持比例积分控制

## 系统架构

```
AD输入 → 混频器 → FIR滤波 → 鉴相器 → 环路滤波器 → NCO → 输出
       ↗       ↘           ↗
     NCO_cos  NCO_sin    相位误差
```

## 文件结构

```
├── README.md              # 项目说明文档
├── doc/                   # 文档目录
│   └── NewStart_FPGA_IO.tcl  # FPGA IO配置脚本
├── prj/                   # 工程文件目录
│   ├── BPSK_demodulator.qpf  # Quartus工程文件
│   ├── BPSK_demodulator.qsf  # Quartus设置文件
│   ├── dds_256x8b_wave.mif   # 正弦波LUT初始化文件
│   └── ipcore/            # IP核目录
│       ├── pll/           # PLL时钟管理IP
│       └── rom/           # ROM查找表IP
├── rtl/                   # RTL源代码目录
│   ├── Costas.v          # 顶层Costas环模块
│   ├── _NCO.v            # 数控振荡器
│   ├── FIR.v             # FIR低通滤波器
│   ├── loop_filter.v     # 环路滤波器
│   └── mixer.v           # 混频器
└── sim/                   # 仿真文件目录
    ├── BPSK_demodu_tb.v  # 测试激励文件
    └── BPSK_demodu_tb.v.bak  # 备份文件
```

## 主要模块说明

### 1. Costas环主模块 (`Costas.v`)
- 顶层模块，集成所有子模块
- 包含PLL时钟管理（100MHz、30MHz、400MHz）
- 处理AD/DA接口信号
- 输出I/Q两路正交信号

### 2. 数控振荡器 (`_NCO.v`)
- 32位相位累加器
- 8位ROM查找表输出
- 支持可配置频率控制字
- 输出正弦/余弦波形

### 3. FIR滤波器 (`FIR.v`)
- 31阶对称FIR滤波器
- 截止频率：0.001π
- 8位输入，16位输出
- 有符号运算，量化系数

### 4. 环路滤波器 (`loop_filter.v`)
- PI控制器结构
- 比例增益Kp=2，积分增益Ki=8
- 初始频率控制字：85899345
- 输出频率控制字给NCO

## 技术参数

| 参数 | 值 | 说明 |
|------|-----|------|
| 系统时钟 | 50MHz | 输入系统时钟 |
| 工作时钟 | 30MHz | PLL分频后的工作时钟 |
| 载波频率 | 1MHz | 目标载波频率 |
| AD精度 | 8位 | 模拟输入精度 |
| DA精度 | 8位 | 模拟输出精度 |
| I/Q输出 | 16位有符号 | 解调后I/Q数据 |
| FIR阶数 | 31阶 | 低通滤波器阶数 |
| NCO位宽 | 32位 | 相位累加器位宽 |

## 使用方法

### 1. 编译工程
1. 打开Quartus Prime
2. 打开工程文件 `prj/BPSK_demodulator.qpf`
3. 编译工程

### 2. 仿真验证
1. 使用ModelSim或Quartus内置仿真器
2. 加载测试文件 `sim/BPSK_demodu_tb.v`
3. 运行仿真，观察I/Q输出波形

### 3. 硬件验证
1. 连接AD/DA转换器
2. 输入1MHz BPSK调制信号
3. 观察解调后的数字输出

## 仿真说明

测试激励文件生成带相位跳变的BPSK信号：
- 载波频率：1MHz
- 相位跳变：180度
- 跳变周期：每100个时钟周期
- 仿真时间：2ms

## 注意事项

1. **时钟域**: 确保所有模块使用正确的时钟域
2. **复位时序**: PLL锁定后才能正常工作
3. **参数调整**: 环路滤波器参数需根据实际信号特性调整
4. **精度考虑**: 注意各模块间的位宽匹配和精度损失

## 开发环境

- **FPGA工具**: Quartus Prime 24.1
- **仿真工具**: ModelSim
- **目标器件**: Altera/Intel FPGA
- **开发语言**: Verilog HDL

## 版本历史

- **v1.0**: 基础Costas环实现
- 支持1MHz载波解调
- 完整的仿真测试平台
